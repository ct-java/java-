# 电商项目面试题
## 订单模块需要用到的表
1. 数据库的设计：订单相关表设计、订单关联的诸如商品列表、会员信息、折扣、积分、打包销售等；账单相关表，包括内部账单和渠道支付账单（如微信支付、支付宝支付等），还有就是操作日志类。建议网上去找一些资料或者开源电商产品参考一下，这块第一次做考虑完整比较难的，当然是根据实际需求裁剪，但如果大面上设计有问题后面功能扩展的时候会非常难受
2. 第三方支付：主要是支付过程中一些正常和异常的流程，微信支付你可以参考它帮助文档中推荐的测试用例，挺完整的；另外就是后台需要轧账和平账，就是你要每天和第三方平台去对一次账，看看两边数据库里的支付情况是否正确
3. 你在上面提到了及时到账，那就证明可能有个人账户体系，这里的充值、提现要想好怎么搞？一般第三方支付针对个人是没有提现接口的，只有退款
## 购物车与商城以及订单的关系
从一般的商城来看，可以分为B2C与C2C，也就是单商城系统和多商城系统。单商城的系统，基本上就是全部商品生成一个订单，而多商城系统里面的购物车则是可以根据店铺来分别支付生成订单（如微店）或者全部统一支付然后根据店铺拆分订单（如有赞，淘宝等）
1. 购物车可以存在多个店铺多个商品，可以一次性给钱购买购物车所有商品
2. 一个订单只能对应一个店铺，一个店铺可以拥有多个订单
3. 微信下单号只有一个，一个微信下单号可以对应多个内部订单号，一个内部订单号只能对应一个微信下单号
## 什么是数据库分片
简单来说，就是指通过某种特定的条件，将我们存放在同一个数据库中的数据分散存放到多个数据库上面，以达到分散单台设备负载的效果。
==数据的切分（Sharding）根据其切分规则的类型，可以分为两种切分模式：==
1. 一种是按照不同的表来切分到不同的数据库（主机）之上，这种切可以称之为数据的垂直切分
2. 另外一种则是根据表中的数据的逻辑关系，将同一个表中的数据按照某种条件拆分到多台数据库上面，这种切分称之为数据的水平切分
## 如何实现数据库的分片
当数据库分片后，数据由一个数据库分散到多个数据库中。此时系统要查询时需要切换不同的数据库进行查询，那么系统如何知道要查询的数据在哪个数据库中？当添加一条记录时要向哪个数据库中插入呢？这些问题处理起来都是非常的麻烦。
这种情况下可以使用一个数据库中间件mycat来解决相关的问题。
## 什么是Mycat？
简单的说，MyCAT就是：一个新颖的数据库中间件产品，支持mysql集群，提供高可用性数据分片集群。你可以像使用mysql一样使用mycat。对于开发人员来说根本感觉不到mycat的存在
## Mycat读写分离
数据库读写分离对于大型系统或者访问量很高的互联网应用来说，是必不可少的一个重要功能。对于MySQL来说，标准的读写分离是主从模式，一个写节点Master后面跟着多个读节点，读节点的数量取决于系统的压力，通常是1-3个读节点的配置
## SSO单点登录
主要解决的是Session共享的问题
1. 使用redis管理Session
2. key：token
3. value：用户信息
4. 可以需要设置有效期
5. 需要把token保存到cookie中。
### SSO单点登录跨越cookie共享
将cookie存在一个公共的站点的页面上就可以了,这里我们管那个站点叫主站S.
#### 首先了解cookie的两个属性
1. domain-域
通过设置这个属性可以使多个web服务器共享cookie。domain属性的默认值是创建cookie的服务器的主机名。不能将一个cookie的域设置成服务器所在的域之外的域
> 例子：让位于a.taotao.com的服务器能够读取b.taotao.com设置的cookie值。如果b.taotao.com的页面创建的cookie把 它的path属性设置为”/”，把domain属性设置成”.taotao.com”，那么所有位于b.taotao.com的网页和所有位于 a.taotao.com的网页，以及位于taotao.com域的其他服务器上的网页都可以访问(或者说是得到)这个cookie。

2. path-路径
表示创建该cookie的服务器的哪些路径下的文件有权限读取该 cookie,默认为/，就是创建该cookie的服务器的根目录

#### 结合单点登录系统说明
A机host设置如下:
127.0.0.1  sso.taotao.com
172.16.30.123  portal.taotao.com

B机host设置如下:
127.0.0.1  portal.taotao.com
172.16.30.123  sso.taotao.com

同时开启两台服务器,sso为单点登录系统,portal为门户系统,portal首页点击登录按钮,可连接到sso系统的登录模块,登录成功后,sso系统设置cookie属性如下:
```Java
token="0821A9439FE4466395A2F4086538AEB4"
Cookie cookie = new Cookie("TT_TOKEN", token);
       cookie.setPath("/");
       cookie.setDomain("taotao.com");
       response.addCookie(cookie);
```
浏览器会根据cookie的domain属性进行判断访问哪个域会携带这个cookie,因为com.taotao.portal属于taotao.com的子域,所以在这个浏览器上访问portal.taotao.com服务器下的所有路径都会携带这个cookie

---
## 购物车
未登录：使用cookie保存购物车数据
登录后：把购物车数据保存到redis
购物车合并，应该以服务端的购物车为准

## 电商活动倒计时方案
1. 确定一个基准时间。可以使用一个sql语句从数据库中取出一个当前时间。SELECT NOW()
2. 活动开始的时间是固定的
3. 使用活动开始时间-基准时间可以计算出一个秒为单位的数值
4. 在redis中设置一个key（活动开始标识）。设置key的过期时间为第三步计算出来的时间
5. 展示页面的时候取出key的有效时间。Ttl命令。使用js倒计时
6. 一旦活动开始的key失效，说明活动开始
7. 需要在活动的逻辑中，先判断活动是否开始
### 秒杀方案
8. 把商品的数量放到redis中
9. 秒杀时使用decr命令对商品数量减一。如果不是负数说明抢到
10. 一旦返回数值变为0说明商品已售完
> 由于宜立方商城是基于SOA的架构，表现层和服务层是不同的工程。所以要实现商品列表查询需要两个系统之间进行通信

## 如何实现远程通信
1. Webservice：效率不高基于soap协议。项目中不推荐使用
2. 使用restful形式的服务：http+json。很多项目中应用。如果服务太多，服务之间调用关系混乱，需要治疗服务
3. 使用dubbo。使用rpc协议进行远程调用，直接使用socket通信。传输效率高，并且可以统计出系统之间的调用关系、调用次数
## 什么是dubbo
- DUBBO是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案
- Dubbo就是资源调度和治理中心的管理工具
